{% extends "header.html" %}
{% block content %}

<!-- Load the Javascript -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript">

    // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart', 'controls']});

    // Callback that creates and populates a data table,
    // instantiates the chart, passes in the data and draws it.
    function drawChart(data_to_display) {

        // Create the data table.
        var data_formatted = new google.visualization.DataTable();
        data_formatted.addColumn('string', 'ID');
        data_formatted.addColumn('string', 'Airport');
        data_formatted.addColumn('number', 'Time of the day');
        data_formatted.addColumn('number', 'Pax local arrival');
        data_formatted.addColumn('number', 'Pax local departure');
        data_formatted.addColumn('number', 'Pax connecting arrival');
        data_formatted.addColumn('number', 'Pax connecting departure');

        for (i = 0; i < data_to_display.length -1; i++) {

              data_formatted.addRows([
                [data_to_display.data[i][0],
                data_to_display.data[i][1],
                parseFloat(data_to_display.data[i][2]),
                data_to_display.data[i][3],
                data_to_display.data[i][4],
                data_to_display.data[i][5],
                data_to_display.data[i][6]
              ]]);
            };

        var dashboard = new google.visualization.Dashboard(
                document.getElementById('dashboard_div'));

            // Create 2 filters, passing some options
        var airportFilter = new google.visualization.ControlWrapper({
              'controlType': 'CategoryFilter',
              'containerId': 'filter_div',
              'options': {
                'values': data_formatted.getDistinctValues(1),
                'filterColumnLabel': "Airport",
                'ui': { 'label': 'Specify airport',
                        'allowMultiple' : false,
                        'allowNone': true},
                'state': {'selectValues': ['LHR']},
              }
            });

            // Create a chart, passing some options
        var myChart = new google.visualization.ChartWrapper({
              'chartType': 'ColumnChart',
              'containerId': 'chart_div',

              // The  chart will only use the columns listed - note:index start at 0 - inverted so connecting is at the bottom
              'view': {'columns': [2,5,6,3,4]},

              'options': {
                'series': {
                          0 : {color: '#00B2D6' },
                          1 : {color: '#00B2D6' },
                          2 : {color: '#272133' },
                          3 : {color: '#272133' },
                        },
                'height':600,
                'width':700,
                'isStacked': true,
                'colors': ['#00b2d6'],
                'backgroundColor': { fill:'#DFDCE3' },
                'legend': {position: 'none'},
                'hAxis': {title: 'Time of the day',
                          textStyle: {color: '#272133', fontName: "Helvetica",fontSize: 16},
                          titleTextStyle: {color: '#272133', fontName: "Helvetica",fontSize: 18}},
                'vAxis': {title: 'Pax Index',
                          textStyle: {color: '#272133', fontName: "Helvetica",fontSize: 16},
                          titleTextStyle: {color: '#272133', fontName: "Helvetica",fontSize: 18},
                          gridlines: {count: 0}},
                },

                'chartArea' : {width:'600px',height:'100%'},
            });

            // Establish dependencies, declaring that 'filter' drives 'Chart',
            // so that the  chart will only display entries that are let through
            // given the filter
            dashboard.bind(airportFilter, myChart);
            dashboard.draw(data_formatted);
            airportFilter.setState({'selectedValues': ['LHR']});
          };



    $(document).ready(function () {
        // prepare the URL to call
        var url_to_call = './airport_data';

        // loading image until the chart is done
        $('#loading_image').show();
        // call API and pass the data to the drawchart function
        $.ajax({
            type: 'GET',
            url: url_to_call,
            dataType: "json",
            crossDomain: true,
            success: function (api_results) {
                drawChart(api_results);
                update_time = new Date(api_results.update);
                document.getElementById("update_time").innerHTML = update_time.toDateString() ;
            },
            complete: function(){
                $('#loading_image').hide();
            },
            error: function (request, status, error) {
                console.log(error);
            }
        });

    });

    </script>

  <!-- HTML -->

        <div class="bg-white">
  	    <div class="container_12 ta-c pt-30 bg-white grey">
  				<div class="dib">
  					<div class="grid_4 ta-c">
  						<div class="p-5">
  							<i class="fa fa-users fa-4x sky-blue"></i>
  							<p class=" text-icon "> Based on 50M+ UMVs </p>
  						</div>
  					</div>

            <div class="grid_4 ta-c">
  						<div class="p-5">
  							<i class="fa fa-calendar fa-4x sky-blue"></i>
  							<p class=" text-icon "> In the last 12 months </p>
  						</div>
  					</div>

						<div class="grid_4 ta-c">
							<div class="p-5">
								<i class="fa fa-bar-chart fa-4x sky-blue"></i>
								<p class=" text-icon ">The busiest times at the airport are:</p>
							</div>
						</div>
					</div>
          <!--Div that holds the animated gif until the chart loads-->
          <div id="loading_image" class="grid_12 pb-30">
            <img src="{{ url_for('static', filename='loading.gif') }}"></img>
          </div>
	       </div>
       </div>

       <div class="bg-light-grey">
        <div class="container_12 ta-c fs-18 pb-30">

            <!--Div that will hold the dashboard-->
            <div id="airport_selected" ></div>
            <div id="dashboard_div" >
              <!--Divs that will hold each control and chart-->
              <div id="chart_div"></div>
              <div id="filter_div" class="grid_12 ta-l pb-30"></div>
            </div>
            <span class=" text-icon "> Last updated on: </span>
            <span id="update_time" class=" text-icon"> - </span>
         </div>

         <div class="container_12 pt-30 pb-30 dark-blue">
           <div class="dib">
             <div class="grid_2">
               <div class="p-5">
                 <i class="fa fa-info-circle fa-5x "></i>
               </div>
             </div>
             <div class="grid_10">
               <div class="p-5">
                 <span class=" fs-16 ">
                   Arriving passengers are above the line departures below.
                   Only major airports are shown
                 </span>
               </div>
             </div>
           </div>
         </div>
       </div>

{% endblock %}
